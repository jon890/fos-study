**JobParameters**. μ΄λ¦„λ§ λ“¤μΌλ©΄ κ·Έμ € 'λ§¤κ°λ³€μ' λ”°μ„λ΅ λ“¤λ¦¬κ² μ§€λ§, κ·Έ μ‹¤μ²΄λ” λ‹¤λ¥΄λ‹¤.

**μ΄κ²ƒμ€ λ°°μΉμ μ΄λ…μ„ κ²°μ •μ§“λ” ν†µμ  λ³€μλ‹¤**

<br>

## JobParametersλ€ λ¬΄μ—‡μΈκ°€?

**JobParameters**λ” λ°°μΉ μ‘μ—…μ— μ „λ‹¬λλ” μ…λ ¥ κ°’μ΄λ‹¤.

μ΄ κ°’μ€ λ°°μΉκ°€ μ–΄λ–¤ μ΅°κ±΄μ—μ„, μ–΄λ–¤ λ°μ΄ν„°λ¥Ό λ‹¤λ£°μ§€λ¥Ό κ²°μ •ν•λ” λ° ν•µμ‹¬μ μΈ μ—­ν• μ„ ν•λ‹¤.

<br>

μλ¥Ό λ“¤μ–΄, **λ§¤μΌ μ‹¤ν–‰λλ” λ°°μΉ μ‘μ—…μ—μ„ λ‚ μ§λ” λ§¤λ² λ°”λ€λ‹¤**.

μ΄λ΄ λ• JobParametersκ°€ μ—†μΌλ©΄ μ‘μ—…μ„ μΌμΌμ΄ μμ •ν•΄μ•Ό ν•  κ²ƒ μ΄λ‹¤.

ν•μ§€λ§ JobParametersλ¥Ό μ‚¬μ©ν•λ©΄?

λ™μΌν• Jobμ„ μ…λ ¥ κ°’λ§ λ°”κΏ”μ„ μ μ—°ν•κ² μ‹¤ν–‰ν•  μ μλ‹¤.

<br>

κ·Έλ°λ° μ—¬κΈ°μ„ μλ¬Έμ΄ λ“¤ μ μλ‹¤.

**"κ·Έλƒ¥ -DΒ μµμ…μΌλ΅ ν”„λ΅νΌν‹°λ΅ μ „λ‹¬ν•λ©΄ λλ”κ±° μ•„λ‹κ°€?"**

<br>

κ·Έλ΄ λ“―ν•κ² λ“¤λ¦¬μ§€λ§, JobParametersμ™€ ν”„λ΅νΌν‹°λ” λ‹¤λ¥Έ λ©μ μ„ κ°€μ§„λ‹¤.

JobParametersλ” λ‹¨μν• κ°’ μ „λ‹¬μ„ λ„μ–΄μ„, λ°°μΉμ μ‹¤ν–‰κ³Ό μ μ–΄λ¥Ό κ΄€λ¦¬ν•λ” ν•µμ‹¬ λ©”μ»¤λ‹μ¦μ΄λ‹¤.

<br>

### ν”„λ΅νΌν‹°μ™€ JobParametersμ κ²°μ •μ  μ°¨μ΄

<br>

- **1\. μ…λ ¥κ°’ λ™μ  λ³€κ²½**
  - λ‹¨μν• νλ¦„μ—μ„λ” ν”„λ΅νΌν‹°λ§μΌλ΅ μ¶©λ¶„ν• μ§€ λ¨λ¥Έλ‹¤.
  - μλ¥Ό λ“¤μ–΄λ³΄μ. μ›Ή μ”μ²­μ΄ λ“¤μ–΄μ¬ λ–„λ§λ‹¤ λΉ„λ™κΈ°λ΅ λ°°μΉ Jobμ„ μ‹¤ν–‰ν•λ” μ¨λΌμΈ λ°°μΉ μ•±μ΄ μλ‹¤. μ΄ μ•±μ€ μ”μ²­μ΄ μ¬ λ•λ§λ‹¤ μƒλ΅μ΄ Jobμ„ μ‹¤ν–‰ν•λ‹¤.
  - μ΄λ° μƒν™©μ—μ„ **μ›Ή μ”μ²­μΌλ΅ μ „λ‹¬λ κ°’μ„ Jobμ μ μ–΄ λ³€μλ΅ μ£Όμ…ν•λ ¤λ©΄?**
  - ν”„λ΅νΌν‹°λ΅λ” λ¶κ°€λ¥ν•λ‹¤.
    - ν”„λ΅νΌν‹°λ” μ•± μ‹μ‘ μ‹ ν• λ² μ£Όμ…λλ” μ •μ μΈ κ°’μ΄λ‹¤.
    - λ³„λ„μ λ¶€κ°€μ μΈ μ²λ¦¬ μ—†μ΄ μ‹¤ν–‰ μ¤‘μΈ μ•±μ— λ™μ μΌλ΅ κ°’μ„ λ³€κ²½ν•  μλ” μ—†λ‹¤.
- **2\. λ©”νƒ€λ°μ΄ν„°**
  - Spring Batchλ” JobParametersμ λ¨λ“  κ°’μ„ λ©”νƒ€λ°μ΄ν„° μ €μ¥μ†μ— κΈ°λ΅ν•λ©°, μ΄λ¥Ό ν†µν•΄ λ‹¤μκ³Ό κ°™μ€ μ¤‘μ”ν• κΈ°λ¥μ„ μ κ³µν•λ‹¤.
    - Job μΈμ¤ν„΄μ¤ μ‹λ³„ λ° μ¬μ‹μ‘ μ²λ¦¬
    - Job μ‹¤ν–‰ μ΄λ ¥ μ¶”μ 
  - λ°λ©΄ ν”„λ΅νΌν‹°λ” Spring Batch λ©”νƒ€λ°μ΄ν„°λ΅ κΈ°λ΅λμ§€ μ•λ”λ‹¤.
    - Job μΈμ¤ν„΄μ¤ μ‹λ³„ λ° μ¬μ‹μ‘ μ²λ¦¬μ— ν™μ©ν•  μ μ—†κ³ , μ΄λ ¥ κ΄€λ¦¬λ„ λ¶κ°€λ¥ν•λ‹¤.
    - μ΄λ” λ°°μΉ μ‘μ—…μ μ΄μκ³Ό μ μ–΄λ¥Ό μ ν•ν•λ” μ”μ†κ°€ λλ‹¤.

<br>

μ΄μ  JobParametersκ°€ λ­”μ§€ μ•μ•μΌλ‹, μ‹¤μ λ΅ μ–΄λ–»κ² μ‚¬μ©ν•λ”μ§€ λ³΄μ.

<br>

## JobParameters μ „λ‹¬ν•κΈ°

μ‹¤μ  μ΄μ ν™κ²½μ—μ„λ” μ»¤λ§¨λ“ λΌμΈμ„ ν†µν•΄ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•λ” λ°©μ‹μ΄ ν•µμ‹¬μ΄λ‹¤.

μ™μΌκΉ? λ€λ¶€λ¶„μ μ¤μΌ€μ¤„λ¬μ™€ μλ™ν™” λ„κµ¬λ“¤μ΄ μ»¤λ§¨λ“λΌμΈ μ‹¤ν–‰μ„ κΈ°λ³ΈμΌλ΅ μ§€μ›ν•κΈ° λ•λ¬Έμ΄λ‹¤.

<br>

κ·Έλ ‡λ‹¤λ©΄ κ°€μ¥ λ¨Όμ € μ»¤λ§¨λ“λΌμΈμ—μ„ JobParametersλ¥Ό μ „λ‹¬ν•λ” λ°©λ²•λ¶€ν„° μ‚΄ν΄λ³΄μ.

<br>

### 1\. μ»¤λ§¨λ“λΌμΈμ—μ„ μ΅ νλΌλ―Έν„° μ „λ‹¬ν•κΈ°

<br>

μ‹¤λ¬΄μ—μ„ κ°€μ¥ ν”ν μ‚¬μ©λλ” μ‹λ‚λ¦¬μ¤ μ¤‘ ν•λ‚λ” νμΌ κ²½λ΅λ¥Ό JobParametersλ΅ λ„κΈ°λ” κ²½μ°λ‹¤.

μλ¥Ό λ“¤μ–΄, νμΌμ„ λ§μ†μ‹ν‚¤λ” λ°°μΉλ¥Ό μ‹¤ν–‰ν•  λ–„, μ–΄λ–¤ νμΌλ“¤μ„ μ κ±°ν• μ§€ νƒ€κ²μ„ μ§€μ •ν•΄μ•Ό ν•μ§€ μ•κ² λ‚?

<br>

```java
./gradlew bootRun --args='--spring.batch.job.name=dataPRocessingJob inputFilePath=/data/input/users.csv,java.lang.String'
```

<br>

`--spring.batch.job.name`μΌλ΅ μ „λ‹¬ν• Job μ΄λ¦„ λ’¤μ•  λ”°λΌμ¤λ” `inputFilePath=/data/input/users.csv,java.lang.String`μ„ λ³΄λΌ.

μ΄κ²ƒμ΄ λ°”λ΅ μ΅ νλΌλ―Έν„°μ΄λ‹¤.

<br>

κ° κµ¬μ„± μ”μ†κ°€ μ •ν™•ν μ–΄λ–¤ μλ―Έλ¥Ό κ°€μ§€κ³  μλ”μ§€ Spring Batchμ JobParameters ν‘κΈ°λ²•μ„ μ‚΄ν΄λ³΄μ.

```
parameterName=parameterValue,parameterType,identificationFlag
```

<br>

- **parameterName**:
  - λ°°μΉ Jobμ—μ„ νλΌλ―Έν„°λ¥Ό μ°Ύμ„ λ• μ‚¬μ©ν•  key κ°’μ΄λ‹¤.
  - μ΄ μ΄λ¦„μΌλ΅ Job λ‚΄μ—μ„ νλΌλ―Έν„°μ— μ ‘κ·Όν•  μ μλ‹¤.
- **parameterValue**:
  - νλΌλ―Έν„°μ μ‹¤μ  κ°’
- **parameterType**:
  - **νλΌλ―Έν„°μ νƒ€μ…(`java.lang.String`, `java.lang.Integer`μ™€ κ°™μ€ fully qualified name μ‚¬μ©)**
  - μ΄ νλΌλ―Έν„° νƒ€μ…μ„ λ…μ‹ν•μ§€ μ•μ„ κ²½μ° Spring Batchλ” ν•΄λ‹Ή νλΌλ―Έν„°λ¥Ό `String` νƒ€μ…μΌλ΅ κ°€μ •ν•λ‹¤.
- **identicationFlag**:
  - Spring Batchμ—κ² ν•΄λ‹Ή νλΌλ―Έν„°κ°€ JobInstance μ‹λ³„μ— μ‚¬μ©λ  νλΌλ―Έν„°μΈμ§€ μ—¬λ¶€λ¥Ό μ „λ‹¬ν•λ” κ°’μΌλ΅ `true` μ΄λ©΄ μ‹λ³„μ— μ‚¬μ©λλ‹¤λ” μλ―Έμ΄λ‹¤.
  - μ΄ ν”λκ·Έλ” μƒλµ κ°€λ¥ν•λ©° μƒλµν•  κ²½μ° `true`λ΅ μ„¤μ •λλ‹¤.
  - JobInstanceκ°€ λ¬΄μ—‡μΈμ§€ JobInstance μ‹λ³„μ΄ λ¬΄μ—‡μΈμ§€λ” ν›„λ°λ¶€μ— λ‹¤λ£¬λ‹¤.

<br>

**κ·Έλ ‡λ‹¤λ©΄ parameterTypeμ—λ” μ–΄λ–¤ κ°’μ΄ μ¬ μ μμ„κΉ?**

<br>

μ»¤λ§¨λ“ λΌμΈ λ¬Έμμ—΄λ΅ μ „λ‹¬λ JobParametersλ” Spring Batchμ `DefaultJobParametersConverter`λΌλ” μ»΄ν¬λ„νΈλ¥Ό ν†µν•΄ μ μ ν• νƒ€μ…μΌλ΅ λ³€ν™λλ‹¤.

λ‚΄λ¶€μ μΌλ΅ Springμ `DefaultConversionService`λ¥Ό μ‚¬μ©ν•κΈ° λ–„λ¬Έμ—, Integer, Booleanκ³Ό κ°™μ€ κΈ°λ³Έ νƒ€μ…μ€ λ¬Όλ΅  κ·Έ μ™Έ λ‹¤μ–‘ν• νƒ€μ…μΌλ΅ λ³€ν™μ„ μ§€μ›ν•λ‹¤.

λ”λ¶μ–΄ μμ²΄μ μΌλ΅ `LocalDate`, `LocalDateTime`κ³Ό κ°™μ€ μ‹κ°„ κ΄€λ ¨ νƒ€μ… λ³€ν™λ„ μ§€μ›ν•λ‹¤.

μ¦‰, λ€λ¶€λ¶„μ use caseμ— ν•΄λ‹Ήν•λ” νƒ€μ…μ€ λ‹¤ μ§€μ›ν•λ‹¤κ³  λ΄λ„ λλ‹¤.

<br>

<br>

## λ‹¤μ–‘ν• νƒ€μ…μ Job νλΌλ―Έν„° μ§€λ°°ν•κΈ°

<br>

### κΈ°λ³Έ λ°μ΄ν„° νƒ€μ… νλΌλ―Έν„° μ „λ‹¬

<br>

λ¨Όμ € κ°€μ¥ κΈ°λ³Έμ΄ λλ” μ •μν•κ³Ό λ¬Έμμ—΄ νƒ€μ…μ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•λ” λ²•μ„ μ•μ•„λ³΄μ.

<br>

```java
@Slf4j
@Configuration
@RequiredArgsConstructor
public class SystemTerminatorConfig {

    private final JobRepository jobRepository;
    private final PlatformTransactionManager transactionManager;


    @Bean
    public Job processTerminatorJob(Step terminationStep) {
        return new JobBuilder("processTerminatorJob", jobRepository)
            .start(terminationStep)
            .build();
    }


    @Bean
    public Step terminationStep(Tasklet terminatorTasklet) {
        return new StepBuilder("terminatorStep", jobRepository)
            .tasklet(terminatorTasklet, transactionManager)
            .build();
    }


    @Bean
    @StepScope
    public Tasklet terminatorTasklet(@Value("#{jobParameters['terminatorId']}") String terminatorId,
                                     @Value("#{jobParameters['targetCount']}") Integer targetCount) {
        return (contribution, chunkContext) -> {
            log.info("μ‹μ¤ν… μΆ…κ²°μ μ •λ³΄:");
            log.info("ID: {}", terminatorId);
            log.info("μ κ±° λ€μƒ μ: {}", targetCount);
            log.info("β΅ SYSTEM TERMINATOR {} μ‘μ „μ„ κ°μ‹ν•©λ‹λ‹¤.", terminatorId);
            log.info("β οΈ {}κ°μ ν”„λ΅μ„Έμ¤λ¥Ό μΆ…λ£ν•©λ‹λ‹¤.", targetCount);

            for (int i = 1; i <= targetCount; i++) {
                log.info("π’€ ν”„λ΅μ„Έμ¤ {} μΆ…λ£ μ™„λ£!", i);
            }

            log.info("π― μ„λ¬΄ μ™„λ£: λ¨λ“  λ€μƒ ν”„λ΅μ„Έμ¤κ°€ μΆ…λ£λμ—μµλ‹λ‹¤.");
            return RepeatStatus.FINISHED;
        };
    }
}
```

<br>

terminatorTasklet() λ©”μ„λ“λ¥Ό λ³΄μ.

λ’¤μ—μ„ λ‹¤μ‹ μ‚΄ν΄λ³΄κ² μ§€λ§ `@Value` μ• λ…Έν…μ΄μ…κ³Ό `#{jobParameters['parameterName']}` ν‘ν„μ‹μΌλ΅ JobParameterλ¥Ό μ£Όμ…λ°›μ„ μ μλ‹¤.

ν•΄λ‹Ή λ©”μ„λ“μ—μ„λ” λ‘ κ°€μ§€ νƒ€μ…μ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ λ°›λ”λ‹¤.

<br>

κ·ΈλΌ μ΄μ  μ΄ μ½”λ“μ— μ§μ ‘ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•΄λ³΄μ.

λ‹¤μκ³Ό κ°™μ΄ μ»¤λ§¨λ“λΌμΈμΌλ΅ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•λ©΄

<br>

```sh
./gradlew bootRun --args='--spring.batch.job.name=processTerminatorJob terminatorId=KILL-9,java.lang.String targetCount=5,java.lang.Integer'
```

<br>

λ‹¤μκ³Ό κ°™μ€ μ‹¤ν–‰ κ²°κ³Όκ°€ μ¶λ ¥λ  κ²ƒμ΄λ‹¤.

<br>

```
2025-12-30T17:36:03.059+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : μ‹μ¤ν… μΆ…κ²°μ μ •λ³΄:
2025-12-30T17:36:03.059+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : ID: KILL-9
2025-12-30T17:36:03.059+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : μ κ±° λ€μƒ μ: 5
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : β΅ SYSTEM TERMINATOR KILL-9 μ‘μ „μ„ κ°μ‹ν•©λ‹λ‹¤.
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : β οΈ 5κ°μ ν”„λ΅μ„Έμ¤λ¥Ό μΆ…λ£ν•©λ‹λ‹¤.
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π’€ ν”„λ΅μ„Έμ¤ 1 μΆ…λ£ μ™„λ£!
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π’€ ν”„λ΅μ„Έμ¤ 2 μΆ…λ£ μ™„λ£!
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π’€ ν”„λ΅μ„Έμ¤ 3 μΆ…λ£ μ™„λ£!
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π’€ ν”„λ΅μ„Έμ¤ 4 μΆ…λ£ μ™„λ£!
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π’€ ν”„λ΅μ„Έμ¤ 5 μΆ…λ£ μ™„λ£!
2025-12-30T17:36:03.060+09:00  INFO 89338 --- [           main] c.b.b.j.SystemTerminatorConfig           : π― μ„λ¬΄ μ™„λ£: λ¨λ“  λ€μƒ ν”„λ΅μ„Έμ¤κ°€ μΆ…λ£λμ—μµλ‹λ‹¤.

...

025-12-30T17:36:03.062+09:00  INFO 89338 --- [           main] o.s.b.c.l.s.TaskExecutorJobLauncher      : Job: [SimpleJob: [name=processTerminatorJob]] completed with the following parameters: [{JobParameter{name='terminatorId', value=KILL-9, type=class java.lang.String, identifying=true},JobParameter{name='targetCount', value=5, type=class java.lang.Integer, identifying=true}}] and the following status: [COMPLETED] in 75ms
```

<br>

λ§μ§€λ§‰ λ΅κ·Έλ¥Ό μ‚΄ν΄λ³΄λ©΄, Spring Batchκ°€ μ¶λ ¥ν• Job μ‹¤ν–‰ κ²°κ³Όμ—μ„ μ°λ¦¬κ°€ μ „λ‹¬ν• **terminatorId**μ™€ **targetCount** νλΌλ―Έν„°κ°€ κ°κ° `String`κ³Ό `Integer` νƒ€μ…μΌλ΅ μ¬λ°”λ¥΄κ² μ „λ‹¬λ κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

<br>

> μ•μ„  μμ μ™€ κ°™μ΄ @Valueλ¥Ό μ‚¬μ©ν•΄ μ΅ νλΌλ―Έν„°λ¥Ό μ „λ‹¬λ°›μΌλ ¤λ©΄ @StepScopeμ™€ κ°™μ€ νΉλ³„ν• μ–΄λ…Έν…μ΄μ…μ„ μ„ μ–Έν•΄μ¤μ•Ό ν•λ‹¤.
>
> Spring Batchμ Scopeμ— λ€ν• μμ„Έν• λ‚΄μ©μ€ λ’¤μ—μ„ λ‹¤λ£° μμ •μ΄λ‹¤.

<br>

### λ‚ μ§μ™€ μ‹κ°„ νλΌλ―Έν„° μ „λ‹¬ (LocalDateμ™€ LocalDateTime νλΌλ―Έν„° μ „λ‹¬ν•κΈ°) μƒλµ..

<br>

### μ—΄κ±°ν• (Enum) νλΌλ―Έν„° μ „λ‹¬ μƒλµ..

<br>

### POJOλ¥Ό ν™μ©ν• Job νλΌλ―Έν„° μ£Όμ…

<br>

λ€κ·λ¨ μ‹μ¤ν… μΉ¨ν¬ μ‘μ „κ³Ό κ°™μ€ λ³µμ΅ν• λ°°μΉ μ‘μ—…μ—μ„λ” μ—¬λ¬ κ°μ Job νλΌλ―Έν„°λ¥Ό ν¨μ¨μ μΌλ΅ κ΄€λ¦¬ν•΄μ•Ό ν•  λ–„κ°€ μλ‹¤.

μ΄λ° κ²½μ° λ³„λ„μ ν΄λμ¤λ¥Ό λ§λ“¤μ–΄ νλΌλ―Έν„°λ¥Ό κ΄€λ¦¬ν•λ©΄ μ½”λ“μ κµ¬μ΅°ν™”μ™€ μ¬μ‚¬μ©μ„±μ„ λ†’μΌ μ μλ‹¤.

<br>

μ΄λ² μμ μ—μ„λ” μ‹μ¤ν… μΉ¨ν¬ μ‘μ „μ νλΌλ―Έν„°λ“¤μ„ ν•λ‚μ POJOλ΅ ν†µν•© κ΄€λ¦¬ν•λ” λ°©λ²•μ„ μ•μ•„λ³΄μ.

```java
@Data
@StepScope
@Component
public class SystemInfiltrationParameters {

    // ν•„λ“ μ£Όμ…
    private final String operationCommander;
    @Value("#{jobParameters[missionName]}")
    private String missionName;
    private int securityLevel;

    // μƒμ„±μ μ£Όμ…
    public SystemInfiltrationParameters(@Value("#{jobParameters[operationCommander]}") String operationCommander) {
        this.operationCommander = operationCommander;
    }

    // setter μ£Όμ…
    @Value("#{jobParameters[securityLevel]}")
    public void setSecurityLevel(int securityLevel) {
        this.securityLevel = securityLevel;
    }
}
```

<br>

μ΄ μ‘μ „ νλΌλ―Έν„° ν΄λμ¤μ ν•µμ‹¬ ν¬μΈνΈλ¥Ό μ‚΄ν΄λ³΄μ

- @Component μ–΄λ…Έν…μ΄μ…μΌλ΅ Spring λΉμΌλ΅ λ“±λ΅λλ‹¤.
- μ•μ„ μ„¤λ…ν–λ“―μ΄ Job νλΌλ―Έν„°λ¥Ό λ°›μΌλ ¤λ©΄ @StepScopeμ™€ κ°™μ€ νΉλ³„ν• μ–΄λ…Έν…μ΄μ…μ΄ ν•„μ”ν•λ‹¤.
- `@Value("#{jobParameters[...]}")` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•΄ λ‹¤μ–‘ν• λ°©μ‹μΌλ΅ Job νλΌλ―Έν„°λ¥Ό μ£Όμ…λ°›μ„ μ μλ‹¤.
  - ν•„λ“ μ§μ ‘ μ£Όμ…
  - μƒμ„±μ νλΌλ―Έν„° μ£Όμ…
  - μ„Έν„° λ©”μ„λ“ μ£Όμ…

<br>

### κΈ°λ³Έ νλΌλ―Έν„° ν‘κΈ°λ²•μ ν•κ³„

<br>

Spring Batchμ κΈ°λ³Έ νλΌλ―Έν„° ν‘κΈ°λ²•μ—λ” ν•κ³„κ°€ μλ‹¤.

μλ¥Ό λ“¤μ–΄, λ‹¤μκ³Ό κ°™μ€ νλΌλ―Έν„°λ¥Ό λ³΄μ.

```
infiltrationTargets=νκµ_μ„λ²„μ‹¤,μ•μ‚°_λ°μ΄ν„°μ„Όν„°,java.lang.String
```

<br>

**νλΌλ―Έν„° κ°’μ— μ΄μ²λΌ μ‰Όν‘(`,`)κ°€ ν¬ν•¨λλ©΄ μ–΄λ–»κ² λ κΉ?**

μ΄ κ²½μ° Spring Batchλ” νλΌλ―Έν„° νƒ€μ…μ„ <strong>'μ•μ‚°\_λ°μ΄ν„°μ„Όν„°'</strong>λ΅ μ¤ν•΄ν•κ² λ  κ²ƒμ΄λ‹¤.

μ‹¤μ λ΅ μ΄ νλΌλ―Έν„°λ΅ Jobμ„ μ‹¤ν–‰ν•λ©΄ μ—λ¬κ°€ λ°μƒν•λ‹¤.

```
Caused by: java.lang.ClassNotFoundException: μ•μ‚°_λ°μ΄ν„°μ„Όν„°
```

<br>

μ΄λ° λ¨νΈν• μƒν™©μ—μ„  μ–΄λ–―κ² ν•΄μ•Ό ν• κΉ?

μ΄λ¥Ό μ„ν•΄ Spring Batch 5λ¶€ν„°λ” JSON κΈ°λ°μ νλΌλ―Έν„° ν‘κΈ°λ²•μ„ μƒλ΅­κ² μ κ³µν•λ‹¤.

<br>

### Job νλΌλ―Έν„°μ JSON κΈ°λ° ν‘κΈ°λ²•

<br>

μ•μ„ μ‚΄ν΄λ³Έ νλΌλ―Έν„°λ¥Ό JOSN ν‘κΈ°λ²•μΌλ΅ μ‘μ„±ν•λ©΄ λ‹¤μκ³Ό κ°™λ‹¤.

<br>

```
infiltrationTargets='{"value": "νκµ_μ„λ²„μ‹¤,μ•μ‚°_λ°μ΄ν„°μ„Όν„°", "type": "java.lang.String"}'
```

<br>

#### JSON κΈ°λ° νλΌλ―Έν„° ν‘κΈ°λ²• μ‚¬μ©μ„ μ„ν• μ¤€λΉ„

<br>

λ¨Όμ €, λ‹¤μμ μμ΅΄μ„±μ„ μ¶”κ°€ν•λ‹¤. **`org.springframework.boot:spring-boot-starter-json`**

κ·Έλ¦¬κ³  Configuration ν΄λμ¤μ— `JsonJobParametersConverter`λ¥Ό λΉμΌλ΅ λ“±λ΅ν•λ‹¤.

```java
@Bean
public JobParametersConverter jobParametersConverter() {
    return new JsonJobParametersConverter();
}
```

<br>

JsonJobParametersConverterλ” μ§€κΈκΉμ§€ μ‚¬μ©ν• DefaultJobParametersConverterλ¥Ό κ³„μΉν• ν΄λμ¤λ΅,

λ‚΄λ¶€μ μΌλ΅ ObjectMapperλ¥Ό μ‚¬μ©ν•΄ JSON ν•νƒμ νλΌλ―Έν„° ν‘κΈ°λ¥Ό ν•΄μ„ν•λ‹¤.

<br>

μ°Έκ³ λ΅ `Gradle bootRun` νƒμ¤ν¬λ΅ μ‹¤ν–‰ν•  λ–„λ” JSON λ¬Έμμ—΄ λ‚΄μ ν° λ”°μ΄ν‘λ¥Ό μ΄μ¤μΌ€μ΄ν”„ μ²λ¦¬ν•΄μ•Ό ν•λ‹¤.

```java
./gradlew bootRun --args="--spring.batch.job.name=terminatorJob infiltrationTargets='{\"value\":\"νκµμ„λ²„μ‹¤,μ•μ‚°λ°μ΄ν„°μ„Όν„°\",\"type\":\"java.lang.String\"}'"
```

<br>

<br>

κ·Έλ°λ° μ°λ¦¬κ°€ μ…λ ¥ν• μ»¤λ§¨λ“λΌμΈ νλΌλ―Έν„°κ°€ μ–΄λ–»κ² Spring Batchμ JobμΌλ΅ μ „λ‹¬λλ” κ±ΈκΉ?

κ·Έ κ³Όμ •μ„ κ°„λ‹¨ν μ‚΄ν΄λ³΄μ.

<br>

## μ»¤λ§¨λ“λΌμΈ νλΌλ―Έν„°λ” μ–΄λ–»κ² μ‹¤μ  JobμΌλ΅ μ „λ‹¬λ κΉ?

Sprig Batchλ¥Ό Spring Boot 3κ³Ό ν•¨κ» μ‚¬μ©ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹μ‘λ  λ• **JobLauncherApplicationRunner**λΌλ” νΉλ³„ν• μ»΄ν¬λ„νΈκ°€ μλ™μΌλ΅ λ™μ‘ν•λ‹¤.

μ΄ μ»΄ν¬λ„νΈλ” Spring Bootκ°€ μ κ³µν•λ” ApplicationRunnerμ ν• μΆ…λ¥λ΅,

μ»¤λ§¨λ“λΌμΈμΌλ΅ μ „λ‹¬λ Spring Batch Job νλΌλ―Έν„°λ¥Ό ν•΄μ„ν•κ³  μ΄λ¥Ό λ°”νƒ•μΌλ΅ μ‹¤μ  Jobμ„ μ‹¤ν–‰ν•λ” μ—­ν• μ„ λ§΅κ³ μλ‹¤.

<br>

JobLauncherApplicationRunnerλ” λ‹¤μκ³Ό κ°™μ€ μ²λ¦¬ κ³Όμ •μ„ κ±°μΉλ‹¤.

- **1\. Job λ©λ΅ μ¤€λΉ„**
  - Spring Bootμ— μν•΄ ApplicationContextμ— λ“±λ΅λ λ¨λ“  Job νƒ€μ… beanμ΄ JobLauncherApplicationRunnerμ— μλ™ μ£Όμ…λλ‹¤.
- **2\. μ ν¨μ„± κ²€μ¦**
  - λ§μ•½ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈμ— JobΒ νƒ€μ… λΉμ΄ μ—¬λ¬ κ°μΈλ° `--spring.batch.job.name`μ„ μ§€μ •ν•μ§€ μ•λ” κ²½μ° κ²€μ¦ μ‹¤ν¨.
  - λ¬Όλ΅  Job νƒ€μ… λΉμ΄ ν•λ‚λ§ μ΅΄μ¬ν•  λ–„λ” `--spring.batch.job.name`μ„ μƒλµν•  μ μλ‹¤.
- **3\. λ…λ Ήμ–΄ ν•΄μ„**
  - μ»¤λ§¨λ“λΌμΈμΌλ΅ μ „λ‹¬λ κ°’λ“¤μ„ νμ‹±ν•λ‹¤.
  - `key=value` ν•μ‹μ μΈμλ“¤μ„ JobParametersλ΅ λ³€ν™ν•λ‹¤.
  - μ΄ κ³Όμ •μ—μ„ μ•μ„ λ‹¤λ£¬ DefaultJobParametersConverterκ°€ μ‚¬μ©λμ–΄ λ¬Έμμ—΄μ„ μ μ ν• νƒ€μ…μ μ΅ νλΌλ―Έν„°λ΅ λ³€ν™ν•λ‹¤.
- **4\. Job μ‹¤ν–‰**
  - μ²« λ‹¨κ³„μ—μ„ μ£Όμ…λ°›μ€ Job λ©λ΅μ—μ„ ν•΄λ‹Ήν•λ” Jobμ„ μ°Ύλ”λ‹¤.
  - ν•΄λ‹Ήν•λ” Jobμ„ μ•μ„ λ³€ν™λ JobParametersμ™€ ν•¨κ» μ‹¤ν–‰ν•λ‹¤.
  - μ΄ κ³Όμ •μ—μ„ JobLauncherλΌλ” Jobμ„ μ‹¤ν–‰μ‹ν‚¤λ” μ»΄ν¬λ„νΈκ°€ μ‚¬μ©λλ‹¤.

<br>

μ§€κΈκΉμ§€λ” μ»¤λ§¨λ“λΌμΈμ„ ν†µν•΄ Job νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•λ” λ°©λ²•μ„ μ•μ•„λ³΄μ•λ”°.

ν•μ§€λ§ μ‹¤λ¬΄μ—μ„λ” μ»¤λ§¨λ“λΌμΈ μ‹¤ν–‰ μ™Έμ—λ„ λ‹¤μ–‘ν• λ°©μ‹μΌλ΅ λ°°μΉλ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•  λ–„κ°€ μλ‹¤.

μλ¥Ό λ“¤μ–΄,

- REST APIλ¥Ό ν†µν•΄ μ™Έλ¶€ μ‹μ¤ν…μ—μ„ λ°°μΉ μ‘μ—…μ„ νΈλ¦¬κ±°ν•΄μ•Ό ν•λ” κ²½μ°
- λ©”μ‹μ§€ ν(RabbitMQ λ“±)μ—μ„ λ©”μ‹μ§€κ°€ λ„μ°©ν–μ„ λ–„ λ°°μΉλ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ” κ²½μ°
- νΉμ • λΉ„μ¦λ‹μ¤ μ΄λ²¤νΈκ°€ λ°μƒν–μ„ λ• λ°°μΉλ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ” κ²½μ° (νμΌ μ—…λ΅λ“ μ™„λ£, μ£Όλ¬Έ μ²λ¦¬ μ™„λ£ λ“±)
- @Scheduled νƒμ¤ν¬μ—μ„ λ™μ  νλΌλ―Έν„°μ™€ ν•¨κΌ λ°°μΉλ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ” κ²½μ°

μ΄λ° μƒν™©μ—μ„λ” ν”„λ΅κ·Έλλ° λ°©μ‹μΌλ΅ JobParametersλ¥Ό μƒμ„±ν•κ³  μ „λ‹¬ν•λ” λ°©λ²•μ΄ ν•„μ”ν•λ‹¤.

<br>

### ν”„λ΅κ·Έλλ° λ°©μ‹μΌλ΅ JobParameters μƒμ„±/μ „λ‹¬ν•κΈ°

<br>

ν”„λ΅κ·Έλλ° λ°©μ‹μΌλ΅ JobParametersλ¥Ό μƒμ„±/μ „λ‹¬ν•λ ¤λ©΄ **JobParametersBuilder**λΌλ” μ»΄ν¬λ„νΈκ°€ ν•„μ”ν•λ‹¤.

μ•μ„ λ³Έ μ»¤λ§¨λ“λΌμΈ μμ μ™€ λΉ„μ·ν•κ² νμΌ κ²½λ΅λ¥Ό νλΌλ―Έν„°λ΅ μ§€μ •ν•λ” λ°©λ²•μ„ μ½”λ“λ΅ κµ¬ν„ν•΄λ³΄μ.

```java
JobParameters jobParameters = new JobParametersBuilder()
  .addJobParameter("inputFilePath", "/data/input/users.csv", String.class)
  .toJobParameters();

jobLauncher.run(dataProcessingJob, jobParameters);
```

<br>

μ½”λ“λ¥Ό μμ„Έν μ‚΄ν΄λ³΄μ.

<br>

JobParametersBuilderλ” μ²΄μ΄λ‹ λ°©μ‹μ APIλ¥Ό μ κ³µν•λ‹¤.

addJobParameters() λ©”μ„λ“λ¥Ό ν†µν•΄ key-value ν•νƒλ΅ νλΌλ―Έν„°λ¥Ό μ¶”κ°€ν•  μ μλ‹¤.

λν• μ„ λ©”μ„λ“λ” νλΌλ―Έν„°μ μ΄λ¦„, κ°’, νƒ€μ…μ„ μμ„λ€λ΅ λ°›λ”λ‹¤. `identifying` λ³€μλ¥Ό λ°›λ” λ©”μ„λ“λ„ μ κ³µν•λ‹¤.

λ™μΌν•κ² μƒλµν• κ²½μ° κΈ°λ³Έκ°’μ€ `true`μ΄λ‹¤.

<br>

<br>

μ§€κΈκΉμ§€ μ°λ¦¬λ” μ»¤λ§¨λ“λΌμΈκ³Ό ν”„λ΅κ·Έλλ° λ°©μ‹μΌλ΅ JobParametersλ¥Ό λ°°μΉ μ΅μ— μ „λ‹¬ν•λ” λ²•μ„ μ•μ•„λƒλ‹¤.

κ·Έλ¦¬κ³  @StepScopeμ™€ @Valueλ¥Ό μ‚¬μ©ν•΄ Job κµ¬μ„± μ½”λ“μ—μ„ νλΌλ―Έν„°λ¥Ό μ°Έμ΅°ν•λ” λ°©λ²•λ„ λ°°μ› λ‹¤.

<br>

κ·Έλ¬λ‚ @Valueλ¥Ό μ‚¬μ©ν•λ” λ°©λ²• μ™Έμ—λ„ JobParametersμ— μ ‘κ·Όν•  μ μλ” λ λ‹¤λ¥Έ λ°©μ‹μ΄ μλ‹¤.

μ΄λ²μ—λ” JobParametersμ— μ§μ ‘ μ ‘κ·Όν•λ” λ°©λ²•μ„ μ•μ•„λ³΄μ.

λ‹¤μ–‘ν• μƒν™©μ—μ„ μ μ—°ν•κ² JobParametersλ¥Ό λ‹¤λ£° μ μμ„ κ²ƒμ΄λ‹¤.

<br>

### JobParameters, μ½”λ“λ΅ μ§μ ‘ μ ‘κ·Όν•κΈ°

<br>

JobParametersμ— μ§μ ‘ μ ‘κ·Όν•λ ¤λ©΄, λ¨Όμ € **JobParametersκ°€ μ–΄λ””μ— μ €μ¥λκ³  κ΄€λ¦¬λλ”μ§€**λ¥Ό μ΄ν•΄ν•΄μ•Ό ν•λ‹¤.

Spring Batchμ—μ„λ” **JobExecution**μ΄λΌλ” λ…€μ„μ΄ Jobμ μ‹¤ν–‰ μ •λ³΄λ¥Ό μ¥κ³  μλ‹¤.

κ²°κµ­ μ¤ν… μ•μ—μ„ JobParametersλ¥Ό μ°Ύμ•„λ‚΄λ ¤λ©΄ μ΄ JobExecutionμ„ ν†µν•΄μ•Ό ν•λ‹¤λ” κ±°λ‹¤.

<br>

> JobExecution μ΄λ€?
>
> Jobμ μ‹¤ν–‰κ³Ό κ΄€λ ¨λ λ¨λ“  μ •λ³΄λ¥Ό λ‹΄κ³  μλ” κ°μ²΄λ‹¤.
>
> Job μ‹¤ν–‰ μ‹μ μ— μƒμ„±λμ–΄ μ΅μ μ‹¤ν–‰ μƒνƒ, JobParameters, μ‹¤ν–‰ κ²°κ³Ό λ“±μ„ ν¬ν•¨ν•λ‹¤.

<br>

μ•„λμ Tasklet μμ λ¥Ό ν†µν•΄ JobExecutionμΌλ΅λ¶€ν„° JobParametersλ¥Ό κ°€μ Έμ¤λ” λ°©λ²•μ„ μ‚΄ν΄λ³΄μ.

```java
@Slf4j
@Component
public class SystemDestructionTasklet implements Tasklet {
   @Override
   public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) {
       JobParameters jobParameters = chunkContext.getStepContext()
                .getStepExecution()
                .getJobParameters();

       String targetSystem = jobParameters.getString("system.target");
       long destructionLevel = jobParameters.getLong("system.destruction.level");

       log.info("νƒ€κ² μ‹μ¤ν…: {}", targetSystem);
       log.info("νκ΄΄ λ λ²¨: {}", destructionLevel);

       return RepeatStatus.FINISHED;
   }
}
```

<br>

<br>

StepExecutionμ€ μ¤ν… μ‹¤ν–‰μ— κ΄€ν• μ •λ³Όλ¥΄ λ‹΄κ³  μλ” κ°μ²΄μ΄λ©΄μ„, λ‚΄λ¶€μ μΌλ΅ λ¶€λ¨ Jobμ JobExecutionμ„ μ°Έμ΅°ν•λ‹¤.

μ¦‰ StepExecutionμ getJobParameters() λ©”μ„λ“λ¥Ό νΈμ¶ν•λ©΄, λ¶€λ¨ JobExecutionμΌλ΅λ¶€ν„° νλΌλ―Έν„°λ¥Ό κ°€μ Έμ¨λ‹¤.

<br>

μ΄λ° κ³„μΈµ κµ¬μ΅°λ¥Ό μ „λ¶€ μ΄ν•΄ν•  ν•„μ”λ” μ—†λ‹¤.

μ¤‘μ”ν• κ±΄ JobExecutionμ΄λ“  StepExecutionμ΄λ“  μ΄λ¥Ό ν†µν•΄ ν”„λ΅κ·Έλλ° λ°”μµμΌλ΅ JobParametersμ— μ ‘κ·Όν•  μ μλ‹¤λ” μ‚¬μ‹¤λ§ κΈ°μ–µν•μ.

<br>

μ, μ΄λ² μ μ—μ„ λ‹¤λ£° Job νλΌλ―Έν„°μ λ§μ§€λ§‰ μ±•ν„°λ‹¤.

λ°”λ΅ νλΌλ―Έν„° κ²€μ¦μ΄λ‹¤.

<br>

### JobParametersValidator

<br>

**JobParametersValidator**λ¥Ό μ‚¬μ©ν•λ©΄ μλ»λ νλΌλ―Έν„°κ°€ λ“¤μ–΄μ¤λ” μκ°„ μ¦‰μ‹ μ°¨λ‹¨ν•  μ μλ‹¤.

λ‹¨μν•λ‹¤. λ‹¨ ν•λ‚μ λ©”μ„λ“λ§ κ°€μ§€κ³  μλ‹¤.

<br>

```java
pubic interface JobParametersValidator {
  void validate(@Nullable JobParameters parameters) throws InvalidJobParametersException;
}
```

<br>

λΉ λ¥΄κ² κµ¬ν„ μμ λ¥Ό ν›‘μ–΄λ³΄μ. λ¨Όμ € μ§μ ‘ JobParametersValidatorλ¥Ό κµ¬ν„ν• μ½”λ“λ¥Ό μ‚΄ν΄λ³΄μ.

```java
@Component
public class SystemDestructionValidator implements JobParametersValidator {

    @Override
    public void validate(JobParameters parameters) throws InvalidJobParametersException {
        if (parameters == null) {
            throw new InvalidJobParametersException("νλΌλ―Έν„°κ°€ NULLμ…λ‹λ‹¤");
        }

        Long destructionPower = parameters.getLong("destructionPower");
        if (destructionPower == null) {
            throw new InvalidJobParametersException("desturctionPower νλΌλ―Έν„°λ” ν•„μ κ°’ μ…λ‹λ‹¤");
        }

        if (destructionPower > 9) {
            throw new InvalidJobParametersException("νκ΄΄λ ¥ μμ¤€μ΄ ν—μ©μΉλ¥Ό μ΄κ³Όν–μµλ‹λ‹¤!");
        }
    }
}
```

<br>

μ„μ™€ κ°™μ€ μ»¤μ¤ν…€ Validatorλ¥Ό μ‚¬μ©ν•λ ¤λ©΄, JobBuilderμ `validator()` λ©”μ„λ“λ¥Ό ν†µν•΄ κµ¬μ„±ν•΄μ¤€λ‹¤.

Job κµ¬μ„±μ—μ„ μ΄ JobParametersValidatorλ¥Ό μ£Όμ…λ°›μ•„ μ‚¬μ©ν•λ©΄ λλ‹¤.

<br>

κ·Έλ¬λ‚ νλΌλ―Έν„° κ²€μ¦μ„ μ„ν•΄ λ§¤λ² JobParametersValidatorλ¥Ό κµ¬ν„ν•λ” κ±΄ λ„λ¬΄ λ²κ±°λ΅­λ‹¤.

λ‹¤ν–‰ν Spring Batchλ” μ΄λ―Έ **DefaultJobParametersValidator**λΌλ” κΈ°λ³Έ κµ¬ν„μ²΄λ¥Ό μ κ³µν•λ‹¤.

λ‹¨μν νλΌλ―Έν„°μ μ΅΄μ¬ μ—¬λ¶€λ§ ν™•μΈν•λ©΄ λ  λ–„λ” μ΄κ±Έ μ‚¬μ©ν•λ©΄ λλ‹¤.

<br>

κ°„λ‹¨ν μμ λ΅ μ‚΄ν΄λ³΄κ³  λ§λ¬΄λ¦¬ν•μ.

```java
@Bean
public Job systemDestructionJob(
    JobRepository jobRepository,
    Step systemDestructionStep
) {
    return new JobBuilder("systemDestructionJob", jobRepository)
        .validator(new DefaultJobParametersValidator(
            new String[]{"destructionPower"},  // ν•„μ νλΌλ―Έν„°
            new String[]{"targetSystem"}       // μ„ νƒμ  νλΌλ―Έν„°
        ))
        .start(systemDestructionStep)
        .build();
}
```
